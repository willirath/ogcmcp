[workspace]
authors = ["Willi Rath <wrath@geomar.de>"]
channels = ["conda-forge"]
name = "ogcmcp"
platforms = ["osx-arm64"]
version = "0.1.0"

[tasks]
test = "pytest tests/ -v"
mitgcm-index = "python -m src.mitgcm.indexer.pipeline"
mitgcm-embed = "nice -n 10 python -u -m src.mitgcm.embedder.pipeline"
mitgcm-embed-docs = "python -u -m src.mitgcm.docs_indexer.pipeline"
mitgcm-embed-verification = "python -u -m src.mitgcm.verification_indexer.pipeline"
mitgcm-serve = "python -m src.mitgcm.server"
fesom2-index = "python -m src.fesom2.indexer.pipeline"
fesom2-embed = "nice -n 10 python -u -m src.fesom2.embedder.pipeline"
fesom2-embed-docs = "python -u -m src.fesom2.embedder.docs_pipeline"
fesom2-embed-namelists = "python -u -m src.fesom2.embedder.nml_pipeline"
fesom2-serve = "python -m src.fesom2.server"
build-image    = "docker build --platform linux/amd64,linux/arm64 -t mitgcm:latest -f docker/mitgcm/Dockerfile ."
build-mcp-image = "docker build --platform linux/amd64 -t ogcmcp:latest -f docker/mcp/Dockerfile ."
build-fesom2-image = "docker build --platform linux/amd64,linux/arm64 -t fesom2:latest -f docker/fesom2/Dockerfile ."
build-fesom2-mcp-image = "docker build --platform linux/amd64 -t ogcmcp-fesom2:latest -f docker/fesom2-mcp/Dockerfile ."
setup-tutorial = "bash scripts/setup-tutorial.sh"
build-tutorial = "bash scripts/build-experiment.sh experiments/mitgcm/tutorial_rotating_tank"
run-tutorial   = "bash scripts/run-experiment.sh experiments/mitgcm/tutorial_rotating_tank"
gen-rotating-convection   = "python experiments/mitgcm/rotating_convection/gen.py"
build-rotating-convection = "bash scripts/build-experiment.sh experiments/mitgcm/rotating_convection"
run-rotating-convection   = "bash scripts/run-experiment.sh experiments/mitgcm/rotating_convection"
run-fesom2-toy-neverworld2  = "bash experiments/fesom2/toy_neverworld2/run.sh"
plot-fesom2-toy-neverworld2 = "python experiments/fesom2/toy_neverworld2/plot.py"

[dependencies]
python = "3.13.*"
matplotlib = ">=3.9, <4"
netcdf4 = ">=1.7, <2"

[pypi-dependencies]
duckdb = ">=1.4.4, <2"
chromadb = ">=1.0"
ollama = ">=0.6.1, <0.7"
fastapi = ">=0.129.0, <0.130"
tree-sitter = ">=0.25.2, <0.26"
tree-sitter-fortran = ">=0.5.1, <0.6"
pytest = ">=9.0.2, <10"
mcp = ">=1.0, <2"
pint = ">=0.24, <1"
f90nml = ">=1.4, <2"
